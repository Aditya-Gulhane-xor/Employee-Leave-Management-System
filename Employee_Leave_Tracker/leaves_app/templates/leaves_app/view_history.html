{% extends "leaves_app/base.html" %}
{% block title %}Leave History{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="text-center mb-4 text-primary fw-bold">Leave History</h2>

  <!-- ✅ Filter Dropdown -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    {% comment %} <p class="text-muted mb-0">
      Showing leaves from <strong>{{ start_date }}</strong> to <strong>{{ end_date }}</strong>
    </p> {% endcomment %}

    <form method="get" class="d-flex align-items-center">
      <label for="filter" class="me-2 fw-semibold mb-0">Filter:</label>
      <select name="filter" id="filter" class="form-select form-select-sm" style="width: 180px;" onchange="this.form.submit()">
        <option value="all" {% if filter_option == 'all' %}selected{% endif %}>All</option>
        <option value="week" {% if filter_option == 'week' %}selected{% endif %}>This Week</option>
        <option value="month" {% if filter_option == 'month' %}selected{% endif %}>This Month</option>
        <option value="year" {% if filter_option == 'year' %}selected{% endif %}>This Year</option>
      </select>
    </form>
  </div>

  <!-- ✅ Leave Table -->
  {% if leaves %}
    <div class="table-responsive shadow-sm">
      <table class="table table-striped table-hover align-middle">
        <thead class="table-primary">
          <tr>
            <th>#</th>
            <th>Type</th>
            <th>Start</th>
            <th>End</th>
            <th>Status</th>
            <th>Reason</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for leave in leaves %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ leave.leave_type.name }}</td>
              <td>{{ leave.start_date }}</td>
              <td>{{ leave.end_date }}</td>
              <td>
                {% if leave.status == 'APPROVED' %}
                  <span class="badge bg-success">Approved</span>
                {% elif leave.status == 'REJECTED' %}
                  <span class="badge bg-danger">Rejected</span>
                {% elif leave.status == 'CANCELLED' %}
                  <span class="badge bg-secondary">Cancelled</span>
                {% else %}
                  <span class="badge bg-warning text-dark">Pending</span>
                {% endif %}
              </td>
              <td>{{ leave.reason|default:"—" }}</td>
              <td>
                {% if leave.status == 'PENDING' %}
                  <a href="{% url 'leaves_app:cancel-leave' leave.id %}" 
                     class="btn btn-sm btn-outline-danger"
                     onclick="return confirm('Are you sure you want to cancel this leave request?');">
                     Cancel Request
                  </a>
                {% else %}
                  <span class="text-muted small">—</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- ✅ Back Button -->
    <div class="text-center mt-4">
      <a href="{% url 'leaves_app:emp-dashboard' %}" class="btn btn-outline-secondary btn-lg">
        ← Back to Dashboard
      </a>
    </div>

  {% else %}
    <div class="alert alert-info text-center shadow-sm">
      No leave records found for this {{ filter_option }}.
    </div>

    <div class="text-center mt-3">
      <a href="{% url 'leaves_app:emp-dashboard' %}" class="btn btn-outline-secondary">
        ← Back to Dashboard
      </a>
    </div>
  {% endif %}
</div>
{% endblock %}
